var center={init:function(){center.bind()},options:{height:window.innerHeight-458},enterWxAuthor:function(){var e=localStorage.getItem("wxUserInfo");if(e)center.init();else{var t=common.getUrlParameter("code");t?(common.getWxUserInfo(),center.init()):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+WX_APPID+"&redirect_uri="+window.location.href+"&response_type=code&scope=snsapi_userinfo#wechat_redirect"}},getMyLotteryCount:function(e){$.ajax({data:{token:e},type:"POST",url:WX_ROOT+"usercenter/queryUserLeftLotteryCount",success:function(e){try{var t=JSON.parse(e);600==t.msgCode?(0==t.detail?$("#lastCountSpan").html("您的抽奖机会已用完"):$("#lastCountSpan").html('剩余<span class="lastCount">'+t.detail+"</span>次抽奖"),$("#lastCountSpan").addClass("lastCountSpan")):610==t.msgCode&&common.tips({msg:"身份验证过期，请重新登录！",updateText:!0,stayTime:2e3,callback:function(){window.location.href=WX_ROOT+"base/login"}})}catch(e){}}})},queryIsWeixinAuthorize:function(e){var t=localStorage.getItem("wxUserInfo"),o=!1;if(t){var n=JSON.parse(t);try{$.ajax({async:!1,data:{openid:n.openid},type:"GET",url:WX_ROOT+"wechat/queryIsWeixinAuthorize",success:function(e){if(e){var t=JSON.parse(e);"true"!=t.detail&&1!=t.detail||(o=!0)}}})}catch(e){}if(!o){var a=localStorage.getItem("userInfo"),e={};if(a){var i=JSON.parse(a);e.mobile=i.mobile,e.openid=n.openid,e.sex=n.sex,e.city=n.city,e.country=n.country,e.headimgurl=n.headimgurl,e.nickname=n.nickname,e.province=n.province,e.language=n.language,e.privilege=n.privilege,$.ajax({data:{jsonData:JSON.stringify(e)},type:"POST",url:WX_ROOT+"wechat/saveUserWeixin",success:function(e){if(e){var t=JSON.parse(e.data);600==t.msgCode&&common.tips({msg:"刷新微信授权信息成功"})}}})}}}},bind:function(){$(".insuranceDiv").css("height",center.options.height);var e=localStorage.getItem("token");e&&center.getMyLotteryCount(e),$(".editBtnDiv,.headerImgDiv>img").on("tap",function(t){e?window.location.href=WX_ROOT+"usercenter/centerInfo":common.tips({msg:"请先登录哦！",callback:function(){window.location.href=WX_ROOT+"base/login"}})}),$(".perfectData").on("tap",function(){window.location.href=WX_ROOT+"usercenter/perfectPersonalData"}),$(".mySocreDiv").on("tap",function(e){var o=localStorage.getItem("token");o?0!=t.detail?window.location.href=WX_ROOT+"usercenter/luckyLottery":common.tips({msg:"您的抽奖次数已用完！"}):common.tips({msg:"请先登录哦！",callback:function(){window.location.href=WX_ROOT+"base/login"}})}),$(".titleDiv").on("tap",function(t){localStorage.setItem("policyStatus","all"),e?window.location.href=WX_ROOT+"usercenter/myInsurancePolicy":common.tips({msg:"请先登录哦！",callback:function(){window.location.href=WX_ROOT+"base/login"}})}),$(".waitDiv").on("tap",function(){localStorage.setItem("policyStatus",0),e?window.location.href=WX_ROOT+"usercenter/myInsurancePolicy":common.tips({msg:"请先登录哦！",callback:function(){window.location.href=WX_ROOT+"base/login"}})}),$(".workDiv").on("tap",function(){localStorage.setItem("policyStatus",3),e?window.location.href=WX_ROOT+"usercenter/myInsurancePolicy":common.tips({msg:"请先登录哦！",callback:function(){window.location.href=WX_ROOT+"base/login"}})}),$(".finishDiv").on("tap",function(){localStorage.setItem("policyStatus",4),e?window.location.href=WX_ROOT+"usercenter/myInsurancePolicy":common.tips({msg:"请先登录哦！",callback:function(){window.location.href=WX_ROOT+"base/login"}})});var t=JSON.parse(localStorage.getItem("wxUserInfo"));t&&$(".headerImgDiv img").attr("src",t.headimgurl);var o=localStorage.getItem("userInfo"),n=$(".user-tel");if(o)try{var t=JSON.parse(o);n.html(t.mobile)}catch(e){n.html('<a href="'+WX_ROOT+'base/login" style="color: #f1eff0;">登录/注册</a>')}else n.html('<a href="'+WX_ROOT+'base/login" style="color: #f1eff0;">登录/注册</a>')}};$(document).ready(function(){var e=localStorage.getItem(CLEAR_FLAG_KEY),t=localStorage.getItem("mobile"),o=localStorage.getItem("userInfo"),n=new Date(ENV_DATE).getTime();o&&!e?(localStorage.clear(),sessionStorage.clear(),t&&localStorage.setItem("mobile",t),localStorage.setItem(CLEAR_FLAG_KEY,n),localStorage.setItem("userInfo","testUser"),center.init()):(localStorage.setItem(CLEAR_FLAG_KEY,n),center.init())});