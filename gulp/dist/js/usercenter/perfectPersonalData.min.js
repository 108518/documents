var perfectPersonalData={init:function(){var e=perfectPersonalData;e.bind(),e.initHtml()},options:{editData:null,editId:null,updateUserFlag:sessionStorage.getItem("updateUserFlag"),defaultProvienceId:5,defaultCityId:76,height:window.innerHeight-458},initHtml:function(){var e=perfectPersonalData,t=JSON.parse(localStorage.getItem("userInfo")),a=$(".headerSpan"),s=$(".InputsDiv"),n=[];switch(parseInt(perfectPersonalData.options.updateUserFlag)){case 1:a.html("修改地址"),n.push('<div class="singleRow border_bottom">'),n.push('<select class="provienceInput areaInput fl" id="provienceSelect">'),n.push('<option value="-1">加载中..</option>'),n.push("</select>"),n.push('<select class="cityInput areaInput fl" id="citySelect">'),n.push('<option value="-1">加载中..</option>'),n.push("</select>"),n.push("</div>"),n.push('<div class="singleRow border_bottom">'),n.push('<input class="addressInput" placeholder="请输入详细地址（收货地址）">'),n.push("</div>"),s.html(n.join("")),e.provience(),e.city(e.options.defaultProvienceId),$("#provienceSelect").val(e.options.defaultProvienceId),$("#citySelect").val(e.options.defaultCityId),$(".provienceInput").on("change",function(){var e=$(".provienceInput").val();perfectPersonalData.city(e)}),$(".addressInput").val(t.address);break;case 2:a.html("修改姓名"),n.push('<div class="singleRow border_bottom">'),n.push('<input class="nameInput" placeholder="请输入您的真实姓名">'),n.push("</div>"),s.html(n.join("")),$(".nameInput").val(t.realName);break;case 3:a.html("修改邮箱"),n.push('<div class="singleRow border_bottom">'),n.push('<input class="emailInput" placeholder="请输入您的邮箱">'),n.push("</div>"),s.html(n.join("")),$(".emailInput").val(t.email);break;case 4:a.html("修改证件号码"),n.push('<div class="singleRow border_bottom">'),n.push('<input class="idCardInput" placeholder="请输入您的证件号码">'),n.push("</div>"),s.html(n.join("")),$(".idCardInput").val(t.idCard);break;case 5:n.push('<div class="singleRow border_bottom">'),n.push('<input class="userNameInput" placeholder="姓名">'),n.push("</div>"),n.push('<div class="singleRow border_bottom">'),n.push('<input class="phoneNumberInput" placeholder="手机号">'),n.push("</div>"),n.push('<div class="singleRow border_bottom">'),n.push('<select class="provienceInput areaInput fl" id="provienceSelect">'),n.push('<option value="-1">加载中..</option>'),n.push("</select>"),n.push('<select class="cityInput areaInput fl" id="citySelect">'),n.push('<option value="-1">加载中..</option>'),n.push("</select>"),n.push("</div>"),n.push('<div class="singleRow border_bottom">'),n.push('<input class="addressInput" placeholder="请输入详细地址（收货地址）">'),n.push("</div>"),n.push('<div class="singleRow border_bottom">'),n.push('<p class="fl">设置为默认地址</p><div class="rightInput fr">'),n.push('<input name="isTransfer" type="hidden" value="0" class="isHostInput">'),n.push('<i class="checkBtn checkOffImg"></i></div>'),n.push("</div>"),s.html(n.join("")),e.provience(),e.city(e.options.defaultProvienceId);var o=localStorage.getItem("editData");if(o){var i=JSON.parse(o);$(".userNameInput").val(i.receiver),$(".phoneNumberInput").val(i.mobile),$(".provienceInput").val(i.provinceId),perfectPersonalData.city(i.provinceId),$(".cityInput").val(i.cityId),$(".addressInput").val(i.address),e.options.editId=i.id,e.options.editData=!0,1==i.isDefault&&$(".checkBtn").removeClass("checkOffImg").addClass("checkOnImg"),localStorage.removeItem("editData")}else $("#provienceSelect").val(e.options.defaultProvienceId),$("#citySelect").val(e.options.defaultCityId);$(".provienceInput").on("change",function(){var e=$(".provienceInput").val();perfectPersonalData.city(e)})}},city:function(e){$.ajax({async:!1,data:{type:"city",provinceId:e},type:"GET",url:WX_ROOT+"insurance/queryProvinceList",beforSend:function(){common.alert({stayTime:-1})},success:function(e){try{var t=JSON.parse(e);if(600==t.code){var t=JSON.parse(e),a="";$(t.data).each(function(e,t){a+="<option value="+t.id+">"+t.name+"</option>"}),$("#citySelect").html(a)}common.alert({show:!1})}catch(e){common.tips({msg:"系统繁忙"})}}})},provience:function(){$.ajax({async:!1,data:{type:"province"},type:"GET",url:WX_ROOT+"insurance/queryProvinceList",beforSend:function(){common.alert({stayTime:-1})},success:function(e){try{var t=JSON.parse(e);if(600==t.code){var t=JSON.parse(e),a="";$(t.data).each(function(e,t){a+="<option value="+t.id+">"+t.name+"</option>"}),$("#provienceSelect").html(a)}common.alert({show:!1})}catch(e){common.tips({msg:"系统繁忙"})}}})},addAddress:function(e,t){var a={};a.token=e,a.flag=2,a.receiver=$(".userNameInput").val().trim(),a.mobile=$(".phoneNumberInput").val().trim(),a.provinceId=$(".provienceInput").val().trim(),a.province=$(".provienceInput").children(":checked").text().trim(),a.cityId=$(".cityInput").val().trim(),a.city=$(".cityInput").children(":checked").text().trim(),a.address=$(".addressInput").val().trim();var s=$(".checkBtn").hasClass("checkOnImg");s?a.isDefault=1:a.isDefault=0,"edit"==t?(a.setType=2,a.id=perfectPersonalData.options.editId):"add"==t&&(a.setType=1),$.ajax({data:a,type:"POST",url:WX_ROOT+"usercenter/userAddress",beforeSend:function(){common.tips({msg:"请稍后.."})},success:function(e){var t=JSON.parse(e);600==t.msgCode?common.tips({msg:"保存成功",updateText:!0,stayTime:1500,callback:function(){window.location.href=WX_ROOT+"usercenter/receiveAddress"}}):610==t.msgCode&&common.tips({msg:"身份验证过期，请重新登录！",updateText:!0,stayTime:2e3,callback:function(){localStorage.setItem("toRegistPage",window.location.href),window.location.href=WX_ROOT+"base/login"}})}})},save:function(e,t){var a={};switch(a.token=e,parseInt(perfectPersonalData.options.updateUserFlag)){case 1:a.flag=1,a.provience=$(".provienceInput :checked").text(),a.city=$(".cityInput :checked").text(),a.address=$(".addressInput").val();break;case 2:a.flag=2,a.username=$(".nameInput").val();break;case 3:a.flag=3,a.email=$(".emailInput").val();break;case 4:a.flag=4,a.idCardNumber=$(".idCardInput").val();break;case 5:a.flag=5;break;case 6:a.flag=6}5==a.flag?perfectPersonalData.options.editData?perfectPersonalData.addAddress(e,"edit"):perfectPersonalData.addAddress(e,"add"):$.ajax({data:a,type:"POST",url:WX_ROOT+"usercenter/updateUserInfo",beforeSend:function(){common.tips({msg:"请稍后.."})},success:function(t){var a=JSON.parse(t.data);600==a.msgCode?common.tips({msg:"修改成功",updateText:!0,stayTime:500,callback:function(){common.queryUserByToken(e);var t=localStorage.getItem("toAdressPage");t?(window.location.href=t,localStorage.removeItem("toAdressPage")):window.location.href=WX_ROOT+"usercenter/centerInfo"}}):610==a.msgCode&&common.tips({msg:"身份验证过期，请重新登录！",updateText:!0,stayTime:2e3,callback:function(){localStorage.setItem("toRegistPage",window.location.href),window.location.href=WX_ROOT+"base/login"}})}})},bind:function(){$(".insuranceDiv").css("height",perfectPersonalData.options.height),$(".ensureBtn").on("tap",function(){var e=localStorage.getItem("token");e?perfectPersonalData.save(e):common.tips({msg:"没有登录",callback:function(){window.location.href=WX_ROOT+"base/login"}})}),$(".contentDiv ").on("tap",".checkBtn",function(){$(this).hasClass("checkOnImg")?$(this).removeClass("checkOnImg").addClass("checkOffImg"):$(this).removeClass("checkOffImg ").addClass("checkOnImg")})}};$(document).ready(function(){perfectPersonalData.init()});