var exchanglist={init:function(){var t=exchanglist;t.bind(),exchanglist.getList(exchanglist.option.openid)},option:{nickName:null,openid:null,fundId:"",mobile:""},getList:function(t){var e={};e.openid=t,common.alert({msg:"加载中.."}),$.ajax({url:WX_CORS,data:{url:"rest/weixin/love/gift",params:JSON.stringify(e)},type:"GET",success:function(t){if(t&&t.code!=-1)if(0==t.code){var e="";if(t.data.length>0)for(var i=0;i<t.data.length;i++)e+=' <li class="boxshadow-bottom singleLi" data-id='+t.data[i].id+"  >",e+='  <div class="topDiv">',e+=' <p class="border-bottom insurenceDesp"><span class="time">'+t.data[i].date+'</span>，自己打卡<span class="time">'+t.data[i].ownerCheck+'</span>次，好友帮赞<span class="time">'+t.data[i].friendCheck+'</span>次,获得一份<span class="label">“旅游保险”</span></p>',e+='</div> <div class="bottomDiv">',e+='<ul class="ui-row">',e+=' <li class="ui-col ui-col-40">&nbsp;</li>',1==t.data[i].status?(e+='<li class="ui-col ui-col-28">',e+='<p class="exchangBtn selfBtn">自己领</p>',e+="</li>",e+='<li class="ui-col ui-col-28">',e+='<p class="exchangBtn otherBtn">送人</p>',e+="</li>"):2==t.data[i].status?(e+='  <li class="ui-col ui-col-28">',e+='<p class="hadgetbtn">已自领</p>',e+="</li>",e+=' <li class="ui-col ui-col-28">',e+='<p class="seeTicketBtn" data-num='+t.data[i].userTicket.ticketNumber+" data-mobile="+t.data[i].userTicket.mobile+">查看兑换券</p>",e+="</li>"):3==t.data[i].status?(e+='<li class="ui-col ui-col-60">',e+='  <p class="hadgetbtn">已送给'+t.data[i].userTicket.mobile+"</p>",e+="</li>"):4==t.data[i].status&&(e+='<li class="ui-col ui-col-60">',e+='  <p class="hadgetbtn">已兑换</p>',e+="</li>"),e+="</ul></div></li>";else e+="还没有兑换券哦";$(".mainListDiv").html(e)}else 8010==t.code&&common.tips({msg:t.msg});else common.error()},timeout:3e3,complete:function(){common.alert("hide")}})},getGift:function(t,e,i,n,a){var s={};s.openid=t,s.fundId=e,s.flag=i,s.mobile=n,s.userName=exchanglist.option.nickName,$.ajax({url:WX_CORS,data:{url:"rest/weixin/love/get-gift",params:JSON.stringify(s)},type:"POST",success:function(t){if(t&&t.code!=-1)if(0==t.code){$(".otherGetTicket").addClass("dis_none"),2==i?($(".selfBtn").addClass("haveCheck"),$(".otherBtn").unbind()):($(".selfBtn").addClass("haveCheck"),$(".otherBtn").unbind()),window.location.href=WX_ROOT+"loveLetter/exchangeList"}else 8010==t.code?common.tips({msg:t.msg}):8023==t.code&&common.tips({msg:t.msg});else common.error()},timeout:3e3})},bind:function(){$(".cancelLookBtn").on("tap",function(){$(this).parents("section").addClass("dis_none")}),$(".cancleBtn").on("tap",function(){$(this).parents("section").addClass("dis_none")}),$(".closeBtn").on("tap",function(){$(this).parents("section").addClass("dis_none")}),$(".mainListDiv").on("tap",".selfBtn",function(){exchanglist.option.fundId=$(this).parents(".singleLi").attr("data-id"),exchanglist.option.flag=2,$(".otherGetTicket").removeClass("dis_none"),$(".contentP").removeClass("dis_none"),$(".otherGetTicket .titleP").text('免费领取"阳光保险"'),$(".otherGetTicket .otherCodeInput").attr("placeholder","输入手机号")}),$(".mainListDiv").on("tap",".otherBtn",function(){exchanglist.option.flag=3,exchanglist.option.fundId=$(this).parents(".singleLi").attr("data-id"),$(".otherGetTicket").removeClass("dis_none"),$(".contentP").addClass("dis_none"),$(".otherGetTicket .titleP").text('赠送"阳光保险"'),$(".otherGetTicket .otherCodeInput").attr("placeholder","输入您想赠送的亲友手机号码")}),$(".mainListDiv").on("tap",".seeTicketBtn",function(){$(".lookTicketNum").removeClass("dis_none"),$(".ticktNum").text($(this).attr("data-num")),$(".phoneNum").text($(this).attr("data-mobile"))}),$(".getTicketBtn").on("tap",function(){var t=$(".otherCodeInput").val().trim(),e=/^1\d{10}$/;t&&e.test(t)?exchanglist.getGift(exchanglist.option.openid,exchanglist.option.fundId,exchanglist.option.flag,t,$(this)):common.tips({msg:"请输入正确手机号"})})}};$(document).ready(function(){var t=JSON.parse(localStorage.getItem("wxUserInfo"));exchanglist.option.openid=t.openid,exchanglist.option.nickName=t.nickname,exchanglist.init()});